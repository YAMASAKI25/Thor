# Thor
a lightweight and plugable DAG engine


# Brief introduction
Thor is a parallel task scheduling framework meticulously crafted for monolithic information retrieval systems with complex processes and logic, possessing outstanding capabilities. It can automatically and accurately deduce the dependency relationships among tasks based on the input content and output results involved in the tasks, and then generate a Directed Acyclic Graph (DAG) on this basis, thus carrying out parallel task scheduling in an orderly manner, providing a powerful support and guarantee for improving the operating efficiency and processing capacity of the information retrieval system.

# Functional features
## Utilizing the function of automatically deducing dependency relationships
- **Deep understanding of task dependencies**: Thor can automatically deduce the dependency relationships between the input and output of tasks. In an information retrieval system, it is necessary to first clarify the logical connections among various retrieval subtasks. For example, in a legal literature retrieval system, if you want to retrieve cases that contain references to specific legal provisions, you may first need to extract the identifiers of relevant provisions from the regulatory database (one subtask), and then match them in the case database according to these identifiers (another subtask). There is a dependency relationship between these two subtasks, where the output (provision identifiers) of the former task is the input of the latter task.
Through careful analysis of the information retrieval process, mark the dependency relationships among different tasks and use Thor's Automatic deduction function to verify and optimize them. If the deduced results do not match the actual situation, it is necessary to check whether the definitions of the input and output of the tasks are accurate, so as to ensure the logical rigor of the entire retrieval process.

- **Constructing a reasonable DAG (Directed Acyclic Graph)**: Based on the automatically deduced dependency relationships, Thor will generate a DAG. When constructing the DAG, it is necessary to consider dividing the tasks that can be executed in parallel into different branches. Taking academic literature retrieval as an example, suppose you need to retrieve papers on a specific topic in a certain academic discipline and extract the experimental data and conclusions from them. The task of retrieving papers and the task of extracting data and conclusions can be separated because to some extent they can be carried out in parallel. After retrieving the papers, data extraction operations can be performed on multiple papers simultaneously.
For the nodes (representing tasks) in the DAG, set their priorities reasonably. If the output of a certain task is the input of multiple subsequent key tasks, then this task should have a higher priority to ensure that the subsequent tasks can be carried out in a timely manner. For example, in an enterprise information retrieval system, the task of obtaining the basic registration information of an enterprise may be the basis for subsequent tasks such as financial information retrieval and product information retrieval, so this basic registration information retrieval task should be given priority.

## Parallel task scheduling strategies
- **Resource allocation optimization**: Understand the hardware resources of the system, including the number of CPU cores and the size of memory. The Thor framework can allocate parallel tasks reasonably according to these hardware resource situations. For example, if the system has multiple CPU cores, computationally intensive retrieval tasks (such as text similarity calculation, index search of large amounts of data, etc.) can be assigned to different cores for simultaneous execution.
Regarding memory resources, it is necessary to avoid excessive occupation of memory by multiple parallel tasks, which may lead to system crashes. The memory limit for each task can be set according to the estimated memory requirements of the tasks. For example, when dealing with the retrieval of a large image database, some image feature extraction tasks may occupy a large amount of memory, so it is necessary to arrange the execution order and resource allocation of these tasks reasonably to ensure the stability and efficiency of the system.

- **Task monitoring and adjustment**: Monitor the execution of parallel tasks in real time. The Thor framework usually provides some monitoring tools or interfaces through which the execution progress and resource usage of tasks can be viewed. If it is found that a certain task takes too long to execute or occupies too many resources, the task can be paused or its priority can be adjusted.
For example, in a multimedia information retrieval system, the audio feature extraction task may have an abnormally long execution time due to problems with the audio file format or data corruption. After detecting this problem through monitoring, the task can be paused, the relevant audio files can be repaired, and the task can be rescheduled for execution. At the same time, the resource allocation of other parallel tasks can be adjusted to reduce the impact on the overall retrieval efficiency. 